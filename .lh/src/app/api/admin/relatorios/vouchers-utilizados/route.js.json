{
    "sourceFile": "src/app/api/admin/relatorios/vouchers-utilizados/route.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 5,
            "patches": [
                {
                    "date": 1740407818137,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1740408021827,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,23 +19,23 @@\n     const query = `\r\n       SELECT \r\n         v.codigo AS voucher_codigo,\r\n         c.nome || ' ' || c.sobrenome AS cliente,\r\n-        uv.data_utilizacao,\r\n-        v.desconto AS valor_desconto\r\n-      FROM utilizacoes_vouchers uv\r\n-      JOIN clientes c ON uv.cliente_id = c.id\r\n-      JOIN vouchers v ON uv.voucher_id = v.id\r\n-      ORDER BY uv.data_utilizacao DESC\r\n+        vu.data_utilizacao,\r\n+        vu.desconto AS valor_desconto\r\n+      FROM voucher_utilizados vu\r\n+      JOIN clientes c ON vu.cliente_id = c.id\r\n+      JOIN vouchers v ON vu.voucher_id = v.id\r\n+      ORDER BY vu.data_utilizacao DESC\r\n     `;\r\n \r\n     const result = await pool.query(query);\r\n \r\n     const vouchersUtilizados = result.rows.map((row) => ({\r\n       codigo: row.voucher_codigo,\r\n       cliente: row.cliente,\r\n       dataUtilizacao: new Date(row.data_utilizacao).toLocaleDateString(\"pt-BR\"),\r\n-      valorDesconto: row.valor_desconto\r\n+      valorDesconto: row.valor_desconto + \"%\" // Adicionando % automaticamente\r\n     }));\r\n \r\n     return new Response(JSON.stringify(vouchersUtilizados), {\r\n       status: 200,\r\n"
                },
                {
                    "date": 1741207416673,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -29,8 +29,17 @@\n     `;\r\n \r\n     const result = await pool.query(query);\r\n \r\n+    // Se n√£o houver registros, retornar uma lista vazia []\r\n+    if (result.rows.length === 0) {\r\n+      console.log(\"‚ö†Ô∏è Nenhum voucher utilizado encontrado.\");\r\n+      return new Response(JSON.stringify([]), { \r\n+        status: 200, \r\n+        headers: { \"Content-Type\": \"application/json\" } \r\n+      });\r\n+    }\r\n+\r\n     const vouchersUtilizados = result.rows.map((row) => ({\r\n       codigo: row.voucher_codigo,\r\n       cliente: row.cliente,\r\n       dataUtilizacao: new Date(row.data_utilizacao).toLocaleDateString(\"pt-BR\"),\r\n"
                },
                {
                    "date": 1741207820465,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -29,9 +29,8 @@\n     `;\r\n \r\n     const result = await pool.query(query);\r\n \r\n-    // Se n√£o houver registros, retornar uma lista vazia []\r\n     if (result.rows.length === 0) {\r\n       console.log(\"‚ö†Ô∏è Nenhum voucher utilizado encontrado.\");\r\n       return new Response(JSON.stringify([]), { \r\n         status: 200, \r\n@@ -42,9 +41,9 @@\n     const vouchersUtilizados = result.rows.map((row) => ({\r\n       codigo: row.voucher_codigo,\r\n       cliente: row.cliente,\r\n       dataUtilizacao: new Date(row.data_utilizacao).toLocaleDateString(\"pt-BR\"),\r\n-      valorDesconto: row.valor_desconto + \"%\" // Adicionando % automaticamente\r\n+      valorDesconto: `${row.valor_desconto}%`\r\n     }));\r\n \r\n     return new Response(JSON.stringify(vouchersUtilizados), {\r\n       status: 200,\r\n"
                },
                {
                    "date": 1741286553259,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -20,12 +20,14 @@\n       SELECT \r\n         v.codigo AS voucher_codigo,\r\n         c.nome || ' ' || c.sobrenome AS cliente,\r\n         vu.data_utilizacao,\r\n-        vu.desconto AS valor_desconto\r\n+        vu.desconto AS valor_desconto,\r\n+        p.nome_empresa AS parceiro\r\n       FROM voucher_utilizados vu\r\n-      JOIN clientes c ON vu.cliente_id = c.id\r\n-      JOIN vouchers v ON vu.voucher_id = v.id\r\n+      INNER JOIN clientes c ON vu.cliente_id = c.id\r\n+      INNER JOIN vouchers v ON vu.voucher_id = v.id\r\n+      INNER JOIN parceiros p ON v.parceiro_id = p.id\r\n       ORDER BY vu.data_utilizacao DESC\r\n     `;\r\n \r\n     const result = await pool.query(query);\r\n@@ -40,8 +42,9 @@\n \r\n     const vouchersUtilizados = result.rows.map((row) => ({\r\n       codigo: row.voucher_codigo,\r\n       cliente: row.cliente,\r\n+      parceiro: row.parceiro,\r\n       dataUtilizacao: new Date(row.data_utilizacao).toLocaleDateString(\"pt-BR\"),\r\n       valorDesconto: `${row.valor_desconto}%`\r\n     }));\r\n \r\n"
                },
                {
                    "date": 1741286579160,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -20,14 +20,12 @@\n       SELECT \r\n         v.codigo AS voucher_codigo,\r\n         c.nome || ' ' || c.sobrenome AS cliente,\r\n         vu.data_utilizacao,\r\n-        vu.desconto AS valor_desconto,\r\n-        p.nome_empresa AS parceiro\r\n+        vu.desconto AS valor_desconto\r\n       FROM voucher_utilizados vu\r\n-      INNER JOIN clientes c ON vu.cliente_id = c.id\r\n-      INNER JOIN vouchers v ON vu.voucher_id = v.id\r\n-      INNER JOIN parceiros p ON v.parceiro_id = p.id\r\n+      JOIN clientes c ON vu.cliente_id = c.id\r\n+      JOIN vouchers v ON vu.voucher_id = v.id\r\n       ORDER BY vu.data_utilizacao DESC\r\n     `;\r\n \r\n     const result = await pool.query(query);\r\n@@ -42,9 +40,8 @@\n \r\n     const vouchersUtilizados = result.rows.map((row) => ({\r\n       codigo: row.voucher_codigo,\r\n       cliente: row.cliente,\r\n-      parceiro: row.parceiro,\r\n       dataUtilizacao: new Date(row.data_utilizacao).toLocaleDateString(\"pt-BR\"),\r\n       valorDesconto: `${row.valor_desconto}%`\r\n     }));\r\n \r\n"
                }
            ],
            "date": 1740407818137,
            "name": "Commit-0",
            "content": "import { Pool } from \"pg\";\r\nimport { getServerSession } from \"next-auth\";\r\nimport { options } from \"@/app/api/auth/[...nextauth]/options\"; // Configura√ß√£o do NextAuth\r\n\r\nconst pool = new Pool({\r\n  connectionString: process.env.DATABASE_URL,\r\n});\r\n\r\nexport async function GET(req) {\r\n  try {\r\n    const session = await getServerSession(options);\r\n\r\n    if (!session || session.user.role !== \"admin\") {\r\n      return new Response(JSON.stringify({ error: \"Acesso negado\" }), { status: 403 });\r\n    }\r\n\r\n    console.log(\"üì° Buscando relat√≥rio de vouchers utilizados...\");\r\n\r\n    const query = `\r\n      SELECT \r\n        v.codigo AS voucher_codigo,\r\n        c.nome || ' ' || c.sobrenome AS cliente,\r\n        uv.data_utilizacao,\r\n        v.desconto AS valor_desconto\r\n      FROM utilizacoes_vouchers uv\r\n      JOIN clientes c ON uv.cliente_id = c.id\r\n      JOIN vouchers v ON uv.voucher_id = v.id\r\n      ORDER BY uv.data_utilizacao DESC\r\n    `;\r\n\r\n    const result = await pool.query(query);\r\n\r\n    const vouchersUtilizados = result.rows.map((row) => ({\r\n      codigo: row.voucher_codigo,\r\n      cliente: row.cliente,\r\n      dataUtilizacao: new Date(row.data_utilizacao).toLocaleDateString(\"pt-BR\"),\r\n      valorDesconto: row.valor_desconto\r\n    }));\r\n\r\n    return new Response(JSON.stringify(vouchersUtilizados), {\r\n      status: 200,\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error(\"‚ùå Erro ao buscar relat√≥rio de vouchers utilizados:\", error);\r\n    return new Response(JSON.stringify({ error: \"Erro ao buscar relat√≥rio de vouchers utilizados\" }), { status: 500 });\r\n  }\r\n}\r\n"
        }
    ]
}