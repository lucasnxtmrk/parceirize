{
    "sourceFile": "src/middleware.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1740052157768,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1740052385519,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,30 +1,19 @@\n import { NextResponse } from 'next/server';\n \n export function middleware(request) {\n-  const token = request.cookies.get('token'); // Ou localStorage, sessionStorage, etc.\n+  const { pathname } = request.nextUrl;\n \n-  // Se não houver token, redireciona para a página de login\n-  if (!token) {\n-    return NextResponse.redirect(new URL('/auth/login-cliente', request.url)); // Ou /auth/login-parceiro, se preferir\n+  if (pathname === '/auth/login-cliente') {\n+    return NextResponse.redirect(new URL('/carteirinha', request.url));\n   }\n \n-  const decodedToken = decodeToken(token);\n-\n-  // Se o token for inválido ou não tiver o campo userType, redireciona para a página de login\n-  if (!decodedToken || !decodedToken.userType) {\n-    return NextResponse.redirect(new URL('/auth/login-cliente', request.url)); // Ou /auth/login-parceiro\n-  }\n-\n-  // Redireciona para a página correta com base no tipo de usuário\n-  if (decodedToken.userType === 'cliente') {\n-    return NextResponse.redirect(new URL('/carteirinha', request.url));\n-  } else if (decodedToken.userType === 'parceiro') {\n+  if (pathname === '/auth/login-parceiro') {\n     return NextResponse.redirect(new URL('/relatorio', request.url));\n   }\n \n-  return NextResponse.next(); // Se o tipo de usuário não for reconhecido, continua para a página solicitada\n+  return NextResponse.next();\n\\ No newline at end of file\n }\n \n export const config = {\n-  matcher: ['/((?!api|static|.*\\\\..*|_next).*)'], // Protege todas as rotas\n-};\n+  matcher: ['/auth/login-cliente', '/auth/login-parceiro'],\n+};\n"
                },
                {
                    "date": 1740053872002,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,19 +1,28 @@\n+import { getToken } from 'next-auth/jwt';\n import { NextResponse } from 'next/server';\n \n-export function middleware(request) {\n-  const { pathname } = request.nextUrl;\n+export async function middleware(req) {\n+    const token = await getToken({ req, secret: process.env.NEXTAUTH_SECRET });\n+    const pathname = req.nextUrl.pathname;\n \n-  if (pathname === '/auth/login-cliente') {\n-    return NextResponse.redirect(new URL('/carteirinha', request.url));\n-  }\n+    const isAuth = !!token;\n+    const isLoginPage = pathname === '/auth/login';\n \n-  if (pathname === '/auth/login-parceiro') {\n-    return NextResponse.redirect(new URL('/relatorio', request.url));\n-  }\n+    const allowedRoutes = ['/carteirinha', '/relatorio', '/admin']; // Rotas que exigem autenticação\n \n-  return NextResponse.next();\n+    const isProtectedRoute = allowedRoutes.includes(pathname);\n+\n+    if (!isAuth && isProtectedRoute && !isLoginPage) {\n+        return NextResponse.redirect(new URL('/auth/login', req.url));\n+    }\n+\n+    if (isAuth && isLoginPage) {\n+        return NextResponse.redirect(new URL('/', req.url));\n+    }\n+\n+    return NextResponse.next();\n }\n \n export const config = {\n-  matcher: ['/auth/login-cliente', '/auth/login-parceiro'],\n+    matcher: ['/((?!api|_next/static|_next/image|favicon.ico|auth).*)']\n };\n\\ No newline at end of file\n"
                },
                {
                    "date": 1740484990009,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,9 +7,9 @@\n \n     const isAuth = !!token;\n     const isLoginPage = pathname === '/auth/login';\n \n-    const allowedRoutes = ['/carteirinha', '/relatorio', '/admin']; // Rotas que exigem autenticação\n+    const allowedRoutes = ['/carteirinha', '/relatorio', '/dashboard']; // Rotas que exigem autenticação\n \n     const isProtectedRoute = allowedRoutes.includes(pathname);\n \n     if (!isAuth && isProtectedRoute && !isLoginPage) {\n"
                },
                {
                    "date": 1748454022357,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,28 +1,35 @@\n-import { getToken } from 'next-auth/jwt';\n-import { NextResponse } from 'next/server';\n+import { NextResponse } from \"next/server\";\n+import { getToken } from \"next-auth/jwt\";\n \n export async function middleware(req) {\n-    const token = await getToken({ req, secret: process.env.NEXTAUTH_SECRET });\n-    const pathname = req.nextUrl.pathname;\n+    const { nextUrl } = req;\n+    const session = await getToken({ req, secret: process.env.NEXTAUTH_SECRET });\n \n-    const isAuth = !!token;\n-    const isLoginPage = pathname === '/auth/login';\n+    // Se estiver acessando a página principal \"/\"\n+    if (nextUrl.pathname === \"/\") {\n+        if (!session) {\n+            // Se não estiver logado, redireciona para a página de login\n+            return NextResponse.redirect(new URL(\"/auth/login\", req.url));\n+        }\n \n-    const allowedRoutes = ['/carteirinha', '/relatorio', '/dashboard']; // Rotas que exigem autenticação\n-\n-    const isProtectedRoute = allowedRoutes.includes(pathname);\n-\n-    if (!isAuth && isProtectedRoute && !isLoginPage) {\n-        return NextResponse.redirect(new URL('/auth/login', req.url));\n+        // Redirecionar para a página correta conforme a role do usuário\n+        switch (session.user.role) {\n\\ No newline at end of file\n+            case \"cliente\":\n+                return NextResponse.redirect(new URL(\"/carteirinha\", req.url));\n+            case \"parceiro\":\n+                return NextResponse.redirect(new URL(\"/relatorio\", req.url));\n+            case \"admin\":\n+                return NextResponse.redirect(new URL(\"/dashboard\", req.url));\n+            default:\n+                return NextResponse.redirect(new URL(\"/auth/login\", req.url));\n+        }\n     }\n \n-    if (isAuth && isLoginPage) {\n-        return NextResponse.redirect(new URL('/', req.url));\n-    }\n-\n+    // Permite continuar normalmente caso a URL não seja \"/\"\n     return NextResponse.next();\n }\n \n+// Define quais rotas serão interceptadas pelo middleware\n export const config = {\n-    matcher: ['/((?!api|_next/static|_next/image|favicon.ico|auth).*)']\n-};\n+    matcher: \"/\",\n+};\n"
                }
            ],
            "date": 1740052157768,
            "name": "Commit-0",
            "content": "import { NextResponse } from 'next/server';\n\nexport function middleware(request) {\n  const token = request.cookies.get('token'); // Ou localStorage, sessionStorage, etc.\n\n  // Se não houver token, redireciona para a página de login\n  if (!token) {\n    return NextResponse.redirect(new URL('/auth/login-cliente', request.url)); // Ou /auth/login-parceiro, se preferir\n  }\n\n  const decodedToken = decodeToken(token);\n\n  // Se o token for inválido ou não tiver o campo userType, redireciona para a página de login\n  if (!decodedToken || !decodedToken.userType) {\n    return NextResponse.redirect(new URL('/auth/login-cliente', request.url)); // Ou /auth/login-parceiro\n  }\n\n  // Redireciona para a página correta com base no tipo de usuário\n  if (decodedToken.userType === 'cliente') {\n    return NextResponse.redirect(new URL('/carteirinha', request.url));\n  } else if (decodedToken.userType === 'parceiro') {\n    return NextResponse.redirect(new URL('/relatorio', request.url));\n  }\n\n  return NextResponse.next(); // Se o tipo de usuário não for reconhecido, continua para a página solicitada\n}\n\nexport const config = {\n  matcher: ['/((?!api|static|.*\\\\..*|_next).*)'], // Protege todas as rotas\n};"
        }
    ]
}